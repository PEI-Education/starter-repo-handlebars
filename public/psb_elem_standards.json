[
   ~[tlist_sql;
     select
      s.id,
      sec.course_number cn,
      substr(sec.course_number,1,2) subject,
      st.name StandardName,
      lower(st.identifier) ident,
      lower(sgs.storecode) store,
      sgs.standardgrade
   from students s
   join standardgradesection sgs
      on sgs.studentsdcid = s.dcid
   left join sections sec
      on sec.dcid = sgs.sectionsdcid
   join standard st
      on st.standardid = sgs.standardid
    Where
    ~[if.~(gpv.dothisfor)=selected] s.dcid in (select dcid from ~[temp.table.current.selection:students])[/if]
    ~[if.~(gpv.dothisfor)=enrolled] s.Enroll_Status = 0[/if]
    ~[if.~(gpv.dothisfor;num)>0] s.id = ~(gpv.dothisfor)[/if]
    ~[if.is.a.school] and sec.schoolid = ~(curschoolid) [/if.is.a.school]      
    and substr(sec.course_number,1,2) = 'HR'
   and sec.schoolid = s.schoolid   --include only grades from current school
   and sgs.storecode in ('R1','R2','R3')
   and sgs.yearid = ~(gpv.yearid)
   UNION ALL
   select
      s.id,
      sec.course_number cn,
      substr(sec.course_number,2,3) subject,
      st.name StandardName,
      lower(substr(st.identifier,6)) ident,
      lower(sgs.storecode) store,
      sgs.standardgrade
   from students s
   join standardgradesection sgs
      on sgs.studentsdcid = s.dcid
   left join sections sec
      on sec.dcid = sgs.sectionsdcid
   join standard st
      on st.standardid = sgs.standardid
   where
    ~[if.~(gpv.dothisfor)=selected] s.dcid in (select dcid from ~[temp.table.current.selection:students])[/if]
    ~[if.~(gpv.dothisfor)=enrolled] s.Enroll_Status = 0[/if]
    ~[if.~(gpv.dothisfor;num)>0] s.id = ~(gpv.dothisfor)[/if]
    ~[if.is.a.school] and sec.schoolid = ~(curschoolid) [/if.is.a.school]  
    and (substr(sec.course_number,2,3) in ('LAN','MAT') OR substr(sec.course_number,2,4) in ('FREF','FREG'))
   and sec.schoolid = s.schoolid   --include only grades from current school
   and sgs.storecode in ('R1','R2','R3')
   and sgs.yearid = ~(gpv.yearid)
   order by 1; 
   ]
      {
         "id": "~(id)",
         "cn": "~(cn;json)",
         "standardname": "~(standardname;json)",
         "identifier": "~(ident;json)",
         "storecode": "~(sc)",
         "grade": "~(grade)"
      },
   [/tlist_sql]
   {}
   
]