[
   ~[tlist_sql;
   with outcomeGrades as (select
      s.id,
      sec.course_number cn,
      case 
         when substr(sec.course_number,2,3) = 'MAT' then 'MAT'
         when substr(sec.course_number,2,3) = 'LAN' then 'ELA'
         when substr(sec.course_number,2,3) = 'FRE' then 'FLA'
         else 'HR' end as subject,
      sgs.storecode storecode,
      sgs.standardgrade standardgrade,
      st.name StandardName,
      st.identifier
   from students s
   join standardgradesection sgs
      on sgs.studentsdcid = s.dcid
   left join sections sec
      on sec.dcid = sgs.sectionsdcid
   left join teachers t
      on t.id = sec.teacher
   join standard st
      on st.standardid = sgs.standardid
   where
   ~[if.~(gpv.dothisfor)=selected] s.dcid in (select dcid from ~[temp.table.current.selection:students])[/if]
   ~[if.~(gpv.dothisfor)=enrolled] s.Enroll_Status = 0[/if]
   ~[if.~(gpv.dothisfor;num4schoolid = ~(curschoolid) [/if.is.a.school]
   (substr(sec.course_number,2,3) in ('LAN','MAT') OR substr(sec.course_number,2,4) in ('FREF','FREG') OR substr(sec.course_number,1,2) = 'HR')
   and sgs.gradelevel > 0  
   and sec.schoolid = s.schoolid   --include only grades from current school
   and sgs.storecode in ('R1','R2','R3')
   and sgs.yearid = ~(gpv.yearid))
   
   select *
   from outcomeGrades
   PIVOT (
   MAX ( standardgrade )
   FOR storecode
   IN ( 'R1' R1, 'R2' R2, 'R3' R3))
   order by id;
   ]
      {
         "id": "~(id)",
         "cn": "~(cn)",
         "subject": "~(subject)",
         "standardname": "~(standardname)",
         "identifier": "~(identifier)",
         "e1": "~(r1)",
         "e2": "~(r2)",
         "e3": "~(r3)"
      },
   [/tlist_sql]
   {}
   
]